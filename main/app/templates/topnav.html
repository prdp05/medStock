{% extends "base.html" %}
{% block title %}Top Navbar{% endblock %}

{% block content %}
<nav class="bg-sky-200 p-4 shadow-md mx-4 my-4">
  <div class="flex justify-between items-center space-x-8">

    <h2 class="text-2xl font-bold">
      <a href="{% url 'home' %}">MedStock</a>
    </h2>

    <form method="GET" id="search-form" class="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg">
      <input
        type="text"
        name="q"
        id="search-input"
        placeholder="Search..."
        class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
      />
      <button
        type="submit"
        class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"
      >
        Search
      </button>
    </form>

    <div class="flex space-x-6 items-center">
      <a href="{% url 'logout' %}" class="text-lg hover:underline text-red-600">Logout</a>
    </div>
  </div>

  <!-- Dropdown for search results -->
  <div id="search-results" class="absolute bg-white shadow-lg rounded-lg w-full mt-2 hidden">
    <!-- Results will be inserted here dynamically -->
  </div>
</nav>

{% endblock %}

{% block extra_js %}
<script>
  let timeout;

  // Debounce function
  const debounceSearch = () => {
    const query = document.getElementById('search-input').value;

    // Clear the previous timeout
    clearTimeout(timeout);

    // Set a new timeout to send the request after 300ms
    timeout = setTimeout(() => {
      if (query) {
        fetchResults(query);
      } else {
        document.getElementById('search-results').classList.add('hidden');
      }
    }, 300); // Adjust the debounce delay time as needed
  };

  // Fetch search results from the backend
  const fetchResults = (query) => {
    fetch(`{% url 'search' %}?q=${query}`)
      .then(response => response.json())
      .then(data => {
        if (data.results.length > 0) {
          console.log(data.results);
          displayResults(data.results);
        } else {
          document.getElementById('search-results').classList.add('hidden');
        }
      })
      .catch(error => console.error("Error fetching results:", error));
  };


  // Event listener for input
  document.getElementById('search-input').addEventListener('input', debounceSearch);
</script>
{% endblock %}
